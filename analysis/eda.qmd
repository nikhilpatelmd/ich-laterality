---
title: "Exploratory Data Analysis"
code-fold: true
---

{{< include 00-setup.qmd >}}

**Things to do**: 

- Collapse some categorical values
- IVH as binary instead of volume

```{r table1, warning=FALSE, message=FALSE}
#| fig-width: 10

table_one_vars <- c("age", "sex", "race", "ethnicity", "time_symptoms_to_ed", "sbp_baseline", "nihss_baseline", "gcs_baseline", "ich_laterality", "htn", "dm2", "stroke", "tobacco", "ich_location", "ich_volume_baseline", "ivh", "study")

table1 <- data |>
  select(table_one_vars) |>
  tbl_summary(
    by = ich_laterality,
    missing = "no",
    label = list(
      age ~ "Age",
      sex ~ "Sex",
      race ~ "Race",
      ethnicity ~ "Ethnicity",
      time_symptoms_to_ed ~ "LNW to ED Presentation (mins)",
      sbp_baseline ~ "Baseline SBP (mm Hg)",
      nihss_baseline ~ "Baseline NIHSS",
      gcs_baseline ~ "Baseline GCS",
      htn ~ "Hypertension",
      dm2 ~ "Type II Diabetes",
      stroke ~ "Previous Stroke",
      tobacco ~ "Tobacco Use",
      ich_location ~ "ICH Location",
      ich_volume_baseline ~ "ICH Volume (mL)",
      ivh ~ "IVH",
      study ~ "Study"
    )
  ) |>
  add_p() |>
  add_overall() |>
  bold_labels()

table1

```

## Aggressiveness of Care

First, we will explore if patients with **left hemispheric** injuries receive less aggressive care. 

```{r neurosurgery, warning=FALSE, message=FALSE}

table_two_vars <- c("neurosurgery_evac", "evd", "tracheostomy", "ich_laterality", "comfort_care_binary")

table2 <- data |>
  select(table_two_vars) |>
  tbl_summary(
    by = ich_laterality,
    missing = "no",
    label = list(
      neurosurgery_evac ~ "Neurosurgical Intervention",
      evd ~ "Ventriculostomy",
      tracheostomy ~ "Tracheostomy", comfort_care_binary ~ "Comfort Care"
    )
  ) |>
  add_p() |>
  add_overall() |>
  bold_labels()

table2

```

### Neurosurgical Intervention

```{r neurosurgical intervention, warning=FALSE, message=FALSE}
#| fig-width: 10

neurosurgery_glm <- glm(
  neurosurgery_evac ~ ich_laterality + age + ich_location + gcs_baseline + ich_volume_baseline + ivh + time_symptoms_to_ed,
  data = data,
  family = binomial
)

model_parameters(neurosurgery_glm,
  centrality = "mean", dispersion = TRUE,
  test = FALSE, verbose = FALSE, ci_method = "hdi", priors = TRUE,
  exponentiate = TRUE
) |>
  print(digits = 2, zap_small = TRUE)

```

## Outcomes


```{r euroqol, warning=FALSE, message=FALSE}
#| fig-width: 10

data <- read_csv(here("data", "all.csv")) |>
  filter(ich_location == c("Lobar", "Basal Ganglia", "Thalamus")) |>
  filter(!is.na(ich_laterality))

data |>
  ggplot(aes(euro_vas_90, fill = ich_laterality)) +
  geom_density(color = NA, alpha = .8)

```