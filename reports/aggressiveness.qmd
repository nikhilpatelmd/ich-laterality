---
title: Differences in care for patients experiencing left vs. right hemisphere ICH
author: Nikhil Patel, MD
format:
  html: 
    mainfont: Figtree
    monofont: Source Code Pro
    fontsize: 0.97rem
    embed-resources: true
    toc: true
    toc-location: left
    toc-depth: 5
    toc-title: Contents
    smooth-scroll: true
    link-external-icon: true
    link-external-newwindow: true
    code-overflow: wrap
    code-tools: true
    highlight-style: nord
    lightbox: true
---

::: {.callout-note icon="false"}
## Research question

Do patients presenting with left hemispheric ICH receive less aggressive care (as measured by rates of neurosurgery, ventriculostomy, tracheostomy, PEG, and early withdrawal of life-sustaining therapies) as compared to those with right hemispheric ICH?

:::


```{r setup, output=FALSE, message=FALSE, warning=FALSE}
#| code-fold: true
#| code-summary: "Loading Libraries and Other Code Setup"

library(targets)
library(skimr)
library(dplyr)
library(gt)
library(gtsummary)
library(ggplot2)
library(ggdag)
library(dagitty)
library(marginaleffects)
library(modelsummary)

# theme customization
theme_set(theme_minimal(base_family = "Figtree"))

theme_set(
  theme_dag() %+replace%
    # also add some additional styling
    theme(
      legend.position = "bottom",
      strip.text.x = element_text(margin = margin(2, 0, 2, 0, "mm"))
    )
)

# load all targets objects
tar_load_everything()

```

## Exploratory Data Analysis

### Data Overview

::: {.callout-warning title="Issues to Address"}
`htn` is missing mostly all information. It is also listed as a character variable.

All other co-morbidities are missing information; if this is the case, should default to "No".

`ivh` is also missing some values, which should also default to "No"?

Any "Yes/No" variable should not have any missing information, should just default to "No"

Verify accuracy/validity of `time_symptoms_to_ed`, `sbp_baseline`, 

Fix/drop unused levels in `race`, and fix "American Indian"

Fix "unknown" category in `ethnicity` to "Not Hispanic or Latino"

Fix/drop unused levels in `ich_location` and `study`
:::

```{r}

glimpse(non_surgery_trials)
skim(non_surgery_trials)

```


### Table 1

::: {.callout-warning title="Issues to Address"}

Collapse unused levels in `race`, `ethnicity`, `ich_location` and `study`

Change order of the displayed factors to frequency 

:::


```{r}

table_1

```

### Relationships between Variables



```{r}
#| fig-align: center

table_2

```

## Statistical Models

::: {.callout-important title="Other Considerations"}

Add analyses stratifying by each study: `ERICH` and `ATACH2`

Construct DAGs for **each** outcome (e.g., each model)!

Add `DNR` in addition to `comfort_care`?

:::

* `neurosurgery_evac`: logistic
* `ventriculostomy`: logistic
* `days_mechanical_ventilation`: poisson (cumulative logit?)
* `tracheostomy`: logistic
* `comfort_care`: logistic (days to comfort care, time to event?)

### DAGs

```{r}
#| width: 1200
#| height: 2000
#| fig-align: center
#|

ggdag(aggressive_dag, use_labels = "label", text = FALSE)

ggdag_adjustment_set(aggressive_dag, shadow = TRUE, use_labels = "label", text = FALSE)

ggdag_adjustment_set(outcome_dag, shadow = TRUE, use_labels = "label", text = FALSE)

aggressive_dag |>
  ggdag_paths(shadow = TRUE, text = FALSE, use_labels = "label")

tidy_dagitty(aggressive_dag)

```

